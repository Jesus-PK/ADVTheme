<ResourceDictionary xmlns="https://github.com/avaloniaui"
					xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
					x:ClassModifier="internal" xmlns:conv="using:Avalonia.Controls.Converters">

	<Design.PreviewWith>
		<Border Padding="200">
			<ComboBox Width="100" PlaceholderText="Select">
				<ComboBoxItem Content="Item 1"/>
				<ComboBoxItem Content="Item 2"/>
				<ComboBoxItem Content="Expandable"/>
			</ComboBox>
		</Border>
	</Design.PreviewWith>
	
	<conv:CornerRadiusFilterConverter x:Key="ComboBoxOpenCorners" Filter="TopLeft,TopRight"/>
	<conv:CornerRadiusFilterConverter x:Key="ComboBoxPopoutCorners" Filter="BottomLeft, BottomRight"/>
	<conv:CornerRadiusFilterConverter x:Key="ComboBoxToggleCorners" Filter="TopRight" Scale="0.5"/>

	<ControlTheme x:Key="ComboBoxToggleButton" TargetType="ToggleButton">
		<Setter Property="Template">
			<ControlTemplate>
				<Border x:Name="PART_Border" Background="{TemplateBinding Background}" CornerRadius="{TemplateBinding CornerRadius}"
						BorderBrush="Transparent" BorderThickness="0" Padding="{TemplateBinding Padding}">
					<Path Width="8" Height="4"
								  HorizontalAlignment="Center"
								  VerticalAlignment="Center"
								  Data="F1 M 301.14,-189.041L 311.57,-189.041L 306.355,-182.942L 301.14,-189.041 Z"
								  Fill="{DynamicResource ADVTheme.Brush.Foreground.Base}"
								  Stretch="Uniform" />
				</Border>
			</ControlTemplate>
		</Setter>

		<Style Selector="^[Tag=True]">
			<Setter Property="Background" Value="{DynamicResource ADVTheme.Brush.Highlight.Base}"/>
		</Style>
	</ControlTheme>

	<ControlTheme x:Key="{x:Type ComboBox}"
	TargetType="ComboBox">
		<Setter Property="Background" Value="{DynamicResource ADVTheme.Brush.Controls.Base}" />
		<Setter Property="Foreground" Value="{DynamicResource ADVTheme.Brush.Foreground.Base}" />
		<Setter Property="BorderBrush" Value="{DynamicResource ADVTheme.Brush.Border.Base}" />
		<Setter Property="CornerRadius" Value="{DynamicResource ADVTheme.CornerRadius}"/>
		<Setter Property="BorderThickness" Value="2" />
		<Setter Property="VerticalContentAlignment" Value="Center" />
		<Setter Property="Padding" Value="4" />
		<Setter Property="MinHeight" Value="20" />
		<Setter Property="PlaceholderForeground" Value="{DynamicResource ADVTheme.Brush.Foreground.Base}" />
		<Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled" />
		<Setter Property="Template">
			<ControlTemplate>
				<Border Name="border" Background="{TemplateBinding Background}"
						BorderBrush="{TemplateBinding BorderBrush}"
						BorderThickness="{TemplateBinding BorderThickness}"
						CornerRadius="{TemplateBinding CornerRadius}">
					<Grid ColumnDefinitions="*,Auto">
						<TextBlock Name="PlaceholderTextBlock" Grid.Column="0"
								   Margin="{TemplateBinding Padding}"
								   HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
								   VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
								   Foreground="{TemplateBinding PlaceholderForeground}"
								   IsVisible="{TemplateBinding SelectionBoxItem, Converter={x:Static ObjectConverters.IsNull}}"
								   Text="{TemplateBinding PlaceholderText}" />
						<ContentControl Margin="{TemplateBinding Padding}"
										HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
										VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
										Content="{TemplateBinding SelectionBoxItem}"
										ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}">
						</ContentControl>
						<ToggleButton Name="toggle" Grid.Column="1" 
									  Theme="{StaticResource ComboBoxToggleButton}"
									  Background="Transparent" Padding="{TemplateBinding Padding}"
									  ClickMode="Press" Focusable="False"
									  CornerRadius="{TemplateBinding CornerRadius, Converter={StaticResource ComboBoxToggleCorners}}"
									  IsChecked="{TemplateBinding IsDropDownOpen, Mode=TwoWay}"/>
						<Popup Name="PART_Popup"
							   MinWidth="{Binding Bounds.Width, RelativeSource={RelativeSource TemplatedParent}}"
							   MaxHeight="{TemplateBinding MaxDropDownHeight}"
							   IsLightDismissEnabled="True"
							   IsOpen="{TemplateBinding IsDropDownOpen, Mode=TwoWay}"
							   PlacementTarget="{TemplateBinding}"
							   InheritsTransform="True">
							<Border Background="{DynamicResource ADVTheme.Brush.Controls.Base}"
									BorderBrush="{DynamicResource ADVTheme.Brush.Border.Base}"
									CornerRadius="{TemplateBinding CornerRadius, Converter={StaticResource ComboBoxPopoutCorners}}"
									BorderThickness="2">
								<ScrollViewer HorizontalScrollBarVisibility="{TemplateBinding ScrollViewer.HorizontalScrollBarVisibility}"
											  VerticalScrollBarVisibility="{TemplateBinding ScrollViewer.VerticalScrollBarVisibility}"
											  IsDeferredScrollingEnabled="{TemplateBinding (ScrollViewer.IsDeferredScrollingEnabled)}">
									<ItemsPresenter Name="PART_ItemsPresenter"
													ItemsPanel="{TemplateBinding ItemsPanel}" />
								</ScrollViewer>
							</Border>
						</Popup>
					</Grid>
				</Border>
			</ControlTemplate>
		</Setter>
		<Style Selector="^:dropdownopen">
			<Setter Property="BorderBrush" Value="{DynamicResource ADVTheme.Brush.Highlight.Base}"/>
		</Style>
		<Style Selector="^:dropdownopen /template/ Border#border">
			<Setter Property="CornerRadius" Value="{TemplateBinding CornerRadius, Converter={StaticResource ComboBoxOpenCorners}}"/>
		</Style>
		<Style Selector="^:dropdownopen /template/ ToggleButton#toggle">
			<Setter Property="Tag" Value="True"/>
		</Style>
		<Style Selector="^:pointerover /template/ Border#border">
			<Setter Property="Background" Value="{DynamicResource ADVTheme.Brush.Controls.Light}"/>
			<Setter Property="BorderBrush" Value="{DynamicResource ADVTheme.Brush.Highlight.Base}" />
		</Style>
		<Style Selector="^:disabled /template/ Border#border">
			<Setter Property="Background" Value="{DynamicResource ADVTheme.Brush.Controls.Dark}"/>
			<Setter Property="Opacity" Value="{DynamicResource ADVTheme.Opacity.Disabled}" />
		</Style>
	</ControlTheme>
</ResourceDictionary>
